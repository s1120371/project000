<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¥åº·ç®¡å®¶ Health Tracker</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="cursor-container">
    <img src="my-cursor.png" />
  </div>

  <div class="aurora-background">
    <div class="aurora-shape shape-1"></div>
    <div class="aurora-shape shape-2"></div>
    <div class="aurora-shape shape-3"></div>
    <div class="aurora-shape shape-4"></div>
    <div class="aurora-shape shape-5"></div>
    <div class="aurora-shape shape-6"></div>
  </div>

  <div class="top-section">
    <header>
      <div class="container">
        <h1><img src="FluentEmojiFlatGreenSalad.png" alt="æ²™æ‹‰åœ–ç¤º" width="40" height="40"> å¥åº·ç®¡å®¶</h1>
        <nav>
          <span id="user-identity" style="margin-right: 20px;"></span>
          <span id="login-links"><a href="/login">ç™»å…¥ / è¨»å†Š</a></span>
          <span id="auth-links" style="display: none;">
            <a href="/edit-profile">å€‹äººè³‡æ–™</a>
            <a href="#" id="logoutBtn">ç™»å‡º</a>
          </span>
        </nav>
      </div>
    </header>

    <div class="nav-wrapper">
      <ul id="nav">
        <li class="slide1"></li>
        <li class="slide2"></li>
        <li><a href="/nutrition">ğŸ± ç‡Ÿé¤Šåˆ†æ</a></li>
        <li><a href="/">â¤ï¸ å¥åº·å»ºè­°</a></li>
        <li><a href="/achievements">ğŸ’ª æˆ‘çš„æˆå°±</a></li>
        <li><a href="/bmi">ğŸ“ BMI è¨ˆç®—</a></li>
      </ul>
    </div>

    <section class="hero">
      <div class="container">
        <h2 id="welcome-title">è®“é£²é£Ÿæ›´æ™ºæ…§ï¼Œå¥åº·çœ‹å¾—è¦‹</h2>
        <p>çµåˆ AI ï¼Œæä¾›å…¨é¢æ€§çš„å¥åº·é£²é£Ÿåˆ†æã€‚</p>
      </div>
    </section>


  </div>

  <section class="user-data container">
    <h2>ğŸ‘¤ ä½¿ç”¨è€…å€‹äººè³‡æ–™</h2>
    <div id="userInfo" class="info-box" style="display:none;">
      <p><strong>å¸³è™Ÿï¼š</strong><span id="username"></span></p>
      <p><strong>å§“åï¼š</strong><span id="fullname"></span></p>
      <p><strong>æ€§åˆ¥ï¼š</strong><span id="gender"></span></p>
      <p><strong>ç”Ÿæ—¥ï¼š</strong><span id="birthdate"></span></p>
      <p><strong>é£²é£Ÿç¿’æ…£ï¼š</strong><span id="diet"></span></p>
      <p><strong>å¥åº·ç›®æ¨™ï¼š</strong><span id="goal"></span></p>
      <p><strong>éæ•æºï¼š</strong><span id="allergens"></span></p>
    </div>
  </section>
  <br>
  <section class="news-preview">
    <div class="container">
      <h3>ğŸ“¢ ç›¸é—œæ–°è</h3>
      <div class="card-container">
        <div class="card">
          <div class="imgBx"
            style="--img:url('https://pgw.udn.com.tw/gw/photo.php?u=https://uc.udn.com.tw/photo/2025/05/14/0/32038101.jpg&x=0&y=0&sw=0&sh=0&sl=W&fw=800&exp=3600&w=465&nt=1')">
          </div>
          <div class="content">
            <h3>æ­£é¤æ™‚é–“å¤–è€è¦ºå¾—é¤“ï¼Ÿææ˜¯è›‹ç™½è³ªä¸è¶³<br /><span>UDN News</span></h3>
            <p>è›‹ç™½è³ªæ˜¯ç¶­æŒå¥åº·èˆ‡ä»£è¬çš„é‡è¦ç‡Ÿé¤Šç´ ï¼Œæ”å–ä¸è¶³æ˜“æ„Ÿç–²æ†Šèˆ‡é£¢é¤“ã€‚å°ˆå®¶å»ºè­°æ¯é¤æ”å–30å…¬å…‹è›‹ç™½è³ªï¼Œå¾æ—©é¤èµ·æ­é…ä¹³è£½å“ã€å …æœç­‰å¤©ç„¶é£Ÿæï¼Œæœ‰åŠ©æå‡é£½è¶³æ„Ÿèˆ‡ä¿®å¾©åŠ›ï¼Œç¶­æŒèº«é«”æ´»åŠ›ã€‚</p>
            <a href="https://udn.com/news/story/7266/8738067" class="news-btn" target="_blank"
              rel="noopener noreferrer">é–±è®€å…¨æ–‡</a>
          </div>
        </div>
        <div class="card">
          <div class="imgBx" style="--img:url('https://img95.699pic.com/photo/50400/6336.jpg_wh860.jpg')"></div>
          <div class="content">
            <h3>æ¸›è‚¥å¤±æ•—çœŸç›¸æ›å…‰ï¼è›‹ç™½è³ªåƒä¸å¤ æ‰æ˜¯ä¸»å› <br /><span>Yahoo News</span></h3>
            <p>ç ”ç©¶æŒ‡å‡ºï¼Œè›‹ç™½è³ªæ”å–ä¸è¶³æœƒå°è‡´éåº¦é€²é£Ÿã€ç†±é‡è¶…æ¨™ï¼Œåè€Œè®Šèƒ–ã€‚æ¸›é‡æ™‚æ‡‰ç¢ºä¿é£²é£Ÿä¸­è›‹ç™½è³ªé”15%ï¼Œæå‡é£½è¶³æ„Ÿã€ç©©å®šé£Ÿæ…¾ï¼Œæ‰èƒ½æœ‰æ•ˆæ§åˆ¶é«”é‡ï¼Œé¿å…é«˜è„‚èˆ‡é«˜ç³–é£²é£Ÿã€‚</p>
            <a href="https://health.udn.com/health/story/6037/8227694" class="news-btn" target="_blank"
              rel="noopener noreferrer">é–±è®€å…¨æ–‡</a>
          </div>
        </div>
        <div class="card">
          <div class="imgBx"
            style="--img:url('https://s.yimg.com/ny/api/res/1.2/O_90tCI_3lPZfh2cLw5Tzg--/YXBwaWQ9aGlnaGxhbmRlcjt3PTk2MDtoPTY0MDtjZj13ZWJw/https://media.zenfs.com/en/evergreen.ttvc.com.tw/06d8a0efa092d7ed5801be5cda75336e')">
          </div>
          <div class="content">
            <h3>é¤Šç”Ÿå¥³è‡ªè£½å¥åº·æ—©é¤ ã€Œ1åƒæ³•ã€éšªå¾—ç³–å°¿ç—…<br /><span>Health UDN</span></h3>
            <p>äº”ç©€ç²‰é›–å¥åº·ï¼Œä½†ç£¨ç²‰å¾Œæ˜“è½‰ç‚ºã€Œç³–æ°´ã€ï¼Œæå°è‡´è‚¥èƒ–èˆ‡è¡€ç³–é£†å‡ã€‚å»ºè­°é¸åŸå‹ç©€ç‰©ã€æ§åˆ¶ä»½é‡ï¼Œæ­é…è›‹ç™½è³ªèˆ‡å¥½æ²¹è„‚ï¼Œé¿å…å¤©å¤©å¤§é‡é£²ç”¨ã€‚</p>
            <a href="https://tw.news.yahoo.com/%E6%B8%9B%E8%82%A5%E5%A4%B1%E6%95%97%E7%9C%9F%E7%9B%B8%E6%9B%9D%E5%85%89-%E8%9B%8B%E7%99%BD%E8%B3%AA%E5%90%83%E4%B8%8D%E5%A4%A0%E6%89%8D%E6%98%AF%E4%B8%BB%E5%9B%A0-002333952.html"
              class="news-btn" target="_blank" rel="noopener noreferrer">é–±è®€å…¨æ–‡</a>
          </div>
        </div>
      </div>
      <p class="update-date"><span>è³‡æ–™æ›´æ–°æ—¥æœŸï¼š</span><span id="updateDate">2025-09-26</span></p>


    </div>

  </section>

  <div class="wave-container">
    <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
      viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
      <defs>
        <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
      </defs>
      <g class="parallax">
        <use xlink:href="#gentle-wave" x="48" y="0" fill="rgba(158, 188, 173,0.7)" />
        <use xlink:href="#gentle-wave" x="48" y="3" fill="rgba(158, 188, 173,0.5)" />
        <use xlink:href="#gentle-wave" x="48" y="5" fill="rgba(158, 188, 173,0.3)" />
        <use xlink:href="#gentle-wave" x="48" y="7" fill="rgba(76,175,80,0.2)" />
      </g>
    </svg>
  </div>

  <footer>
    <p>&copy; 2025 å¥åº·ç®¡å®¶ Health Tracker</p>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const idToken = sessionStorage.getItem('firebaseIdToken');
      const userIdentity = document.getElementById("user-identity");
      const authLinks = document.getElementById("auth-links");
      const loginLinks = document.getElementById("login-links");
      const welcomeTitle = document.getElementById("welcome-title");
      const userInfoBox = document.getElementById("userInfo");

      if (!idToken) {
        authLinks.style.display = "none";
        loginLinks.style.display = "inline";
        welcomeTitle.textContent = "æ­¡è¿è¨ªå®¢ï¼ç™»å…¥å¾Œå¯æŸ¥çœ‹å€‹äººåŒ–è³‡è¨Š";
        userInfoBox.innerHTML = '<p>è«‹<a href="/login">ç™»å…¥</a>ä»¥æŸ¥çœ‹æ‚¨çš„å€‹äººè³‡æ–™ã€‚</p>';
        userInfoBox.style.display = "block";
        return;
      }

      try {
        const response = await fetch('/api/user-profile', {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${idToken}`
          }
        });

        if (!response.ok) {
          const errData = await response.json();
          throw new Error(errData.error || 'ç„¡æ³•ç²å–ä½¿ç”¨è€…è³‡æ–™ï¼Œè«‹é‡æ–°ç™»å…¥');
        }

        const data = await response.json();

        authLinks.style.display = "inline";
        loginLinks.style.display = "none";

        const username = data.username || data.email;
        welcomeTitle.textContent = `ğŸ‘‹ æ­¡è¿å›ä¾†ï¼Œ${username}`;
        userIdentity.textContent = username;

        userInfoBox.style.display = "block";
        document.getElementById("username").textContent = data.username || "æœªå¡«å¯«";
        document.getElementById("fullname").textContent = data.fullname || "æœªå¡«å¯«";
        document.getElementById("gender").textContent = data.gender || "æœªå¡«å¯«";
        document.getElementById("birthdate").textContent = data.birthdate || "æœªå¡«å¯«";
        document.getElementById("diet").textContent = data.diet || "æœªå¡«å¯«";
        document.getElementById("goal").textContent = data.goal || "æœªå¡«å¯«";
        document.getElementById("allergens").textContent = (data.allergens || []).join(", ") || "ç„¡";

      } catch (error) {
        console.error('API å‘¼å«å¤±æ•—:', error);
        sessionStorage.removeItem('firebaseIdToken');
        authLinks.style.display = "none";
        loginLinks.style.display = "inline";
        welcomeTitle.textContent = "æ­¡è¿è¨ªå®¢ï¼ç™»å…¥å¾Œå¯æŸ¥çœ‹å€‹äººåŒ–è³‡è¨Š";
        userInfoBox.innerHTML = `<p>âš ï¸ é©—è­‰å·²éæœŸï¼Œè«‹<a href="/login">é‡æ–°ç™»å…¥</a>ä»¥æŸ¥çœ‹æ‚¨çš„å€‹äººè³‡æ–™ã€‚</p>`;
        userInfoBox.style.display = "block";
      }
    });

    const logoutBtn = document.getElementById("logoutBtn");
    logoutBtn?.addEventListener("click", () => {
      sessionStorage.removeItem('firebaseIdToken');
      window.location.href = "/login";
    });
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script>
    $(document).ready(function () {
      $("#nav a").on("click", function () {
        var position = $(this).parent().position();
        var width = $(this).parent().width();
        $("#nav .slide1").css({ opacity: 1, left: +position.left, width: width });
      });
      $("#nav a").on("mouseover", function () {
        var position = $(this).parent().position();
        var width = $(this).parent().width();
        $("#nav .slide2").css({ opacity: 1, left: +position.left, width: width }).addClass("squeeze");
      });
      $("#nav a").on("mouseout", function () {
        $("#nav .slide2").css({ opacity: 0 }).removeClass("squeeze");
      });

      function setActiveSlide() {
        var currentPath = window.location.pathname;
        var activeLink = null;

        $("#nav li a").each(function () {
          if ($(this).attr('href') === currentPath) {
            activeLink = $(this);
            return false;
          }
        });

        if (!activeLink) {
          activeLink = $("#nav li a[href='/']");
        }

      }

      setActiveSlide();
    });
  </script>

  <!-- æ–°å¢çš„æ»‘é¼ è¿½è¹¤è…³æœ¬ -->
  <script>
    const cursorImg = document.querySelector('.cursor-container img');
    let angle = 0;
    window.addEventListener('mousemove', function (e) {
      if (Math.abs(e.movementX + e.movementY) > 1) {
        angle = Math.atan2(e.movementX, -e.movementY);
      }
      if (cursorImg) {
        cursorImg.style.transform = `translate(${e.clientX}px, ${e.clientY}px) rotate(${angle}rad)`;
      }
    })
  </script>

</body>

</html>
