<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¥åº·ç®¡å®¶ Health Tracker</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Noto Sans TC', sans-serif;
    }

    body {
      background-color: #f7f9fc;
      color: #333;
      line-height: 1.6;
    }

    .container {
      width: 90%;
      max-width: 1000px;
      margin: 0 auto;
    }

    header {
      background-color: #4CAF50;
      color: white;
      padding: 15px 0;
    }

    header .container {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    header nav a {
      color: white;
      margin-left: 20px;
      text-decoration: none;
      font-weight: bold;
    }

    header nav a:hover {
      text-decoration: underline;
    }

    .top-function-nav {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      background: #fff;
      padding: 15px 0;
      gap: 20px;
      border-bottom: 1px solid #ddd;
    }

    .top-function-nav a {
      text-decoration: none;
      color: #4CAF50;
      font-size: 1.1rem;
      font-weight: bold;
      transition: color 0.2s;
    }

    .top-function-nav a:hover {
      color: #2e7d32;
    }

    .hero {
      background: #e8f5e9;
      padding: 60px 0;
      text-align: center;
    }

    footer {
      width: 100%;
      background-color: #f1f1f1;
      color: #666;
      text-align: center;
      padding: 20px 0;
      font-size: 0.9rem;
      margin-top: 40px;
    }

    .user-data {
      margin-top: 40px; /* æ–°å¢çš„é–“è· */
    }

    .info-box {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #ddd;
      margin-top: 20px; /* æ–°å¢çš„é–“è· */
    }

    .info-box p {
      margin-bottom: 10px;
    }

    
    .update-date {
    font-size: 0.8rem;
    color: #888;
    text-align: right;
    margin-top: 15px;
  }

  /* æ›´æ–°æ—¥æœŸå­—æ¨£ */
  .update-date span {
    font-weight: normal;
  }

    .news-preview {
      padding: 40px 0;
      background-color: #f4f9ff;
      text-align: left;
      margin-bottom: 40px;
    }

    .news-preview h3 {
      font-size: 1.8rem;
      color: #2e5caa;
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
      text-align: center;
    }

    .news-list {
      display: flex;
      flex-direction: column;
      gap: 20px;
      align-items: center;
    }

    .news-item {
      background: #ffffff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      transition: transform 0.3s, box-shadow 0.3s;
      position: relative;
      overflow: hidden;
      border-left: 5px solid #2e5caa;
      width: 100%;
      max-width: 1000px;
      margin: 0 auto;
      text-align: left;
    }

    .news-item:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
    }

    .news-item h4 {
      font-size: 1.2rem;
      margin-bottom: 8px;
      color: #2e5caa;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .news-item h4::before {
      content: "ğŸ¥¬";
      font-size: 1.4rem;
      margin-right: 8px;
    }

    .news-item p {
      font-size: 0.95rem;
      color: #555;
      margin-bottom: 12px;
      line-height: 1.6;
    }

    .news-btn {
      display: inline-block;
      background-color: #2e5caa;
      color: #ffffff;
      padding: 8px 16px;
      font-size: 0.9rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
      text-decoration: none;
      font-weight: bold;
      text-align: center;
    }

    .news-btn:hover {
      background-color: #1f3e7a;
    }

    .news-btn:focus {
      outline: none;
      box-shadow: 0 0 0 4px rgba(46, 92, 170, 0.2);
    }
  </style>
</head>

<body>
  <header>
    <div class="container">
      <h1>å¥åº·ç®¡å®¶</h1>
      <nav>
        <span id="user-identity" style="margin-right: 20px;"></span>
        <span id="login-links"><a href="/login">ç™»å…¥ / è¨»å†Š</a></span>
        <span id="auth-links" style="display: none;">
          <a href="/edit-profile">å€‹äººè³‡æ–™</a>
          <a href="#" id="logoutBtn">ç™»å‡º</a>
        </span>
      </nav>
    </div>
  </header>

  <nav class="top-function-nav">
    <a href="/nutrition">ğŸ± ç‡Ÿé¤Šåˆ†æ</a>
    <a href="/">â¤ï¸ å¥åº·å»ºè­°</a>
    <a href="/achievements">ğŸ’ª æˆ‘çš„æˆå°±</a>
    <a href="/bmi">ğŸ“ BMI è¨ˆç®—</a>
  </nav>

  <section class="hero">
    <div class="container">
      <h2 id="welcome-title">è®“é£²é£Ÿæ›´æ™ºæ…§ï¼Œå¥åº·çœ‹å¾—è¦‹</h2>
      <p>çµåˆ AI ï¼Œæä¾›å…¨é¢æ€§çš„å¥åº·é£²é£Ÿåˆ†æã€‚</p>
    </div>
  </section>

  <section class="user-data container">
    <h2>ğŸ‘¤ ä½¿ç”¨è€…å€‹äººè³‡æ–™</h2>
    <div id="userInfo" class="info-box" style="display:none;">
      <p><strong>å¸³è™Ÿï¼š</strong><span id="username"></span></p>
      <p><strong>å§“åï¼š</strong><span id="fullname"></span></p>
      <p><strong>æ€§åˆ¥ï¼š</strong><span id="gender"></span></p>
      <p><strong>ç”Ÿæ—¥ï¼š</strong><span id="birthdate"></span></p>
      <p><strong>é£²é£Ÿç¿’æ…£ï¼š</strong><span id="diet"></span></p>
      <p><strong>å¥åº·ç›®æ¨™ï¼š</strong><span id="goal"></span></p>
      <p><strong>éæ•æºï¼š</strong><span id="allergens"></span></p>
    </div>
  </section>

  <section class="news-preview">
    <div class="container">
      <h3>ğŸ“¢ ç›¸é—œæ–°è</h3>
      <div class="news-list">
        <div class="news-item">
          <h4>æ­£é¤æ™‚é–“å¤–è€è¦ºå¾—é¤“ï¼Ÿææ˜¯è›‹ç™½è³ªä¸è¶³ ç‡Ÿé¤Šå¸«æ•™ç°¡å–®è£œè¶³æ“ºè„«ç–²å‹</h4>
          <p>è›‹ç™½è³ªæ˜¯ç¶­æŒå¥åº·èˆ‡ä»£è¬çš„é‡è¦ç‡Ÿé¤Šç´ ï¼Œæ”å–ä¸è¶³æ˜“æ„Ÿç–²æ†Šèˆ‡é£¢é¤“ã€‚å°ˆå®¶å»ºè­°æ¯é¤æ”å–30å…¬å…‹è›‹ç™½è³ªï¼Œå¾æ—©é¤èµ·æ­é…ä¹³è£½å“ã€å …æœç­‰å¤©ç„¶é£Ÿæï¼Œæœ‰åŠ©æå‡é£½è¶³æ„Ÿèˆ‡ä¿®å¾©åŠ›ï¼Œç¶­æŒèº«é«”æ´»åŠ›ã€‚</p>
          <a href="https://udn.com/news/story/7266/8738067" class="news-btn" target="_blank"
            rel="noopener noreferrer">é–±è®€å…¨æ–‡</a>
        </div>
        <div class="news-item">
          <h4>é¤Šç”Ÿå¥³è‡ªè£½å¥åº·æ—©é¤ ã€Œ1åƒæ³•ã€éšªå¾—ç³–å°¿ç—…ï¼å¾ˆå¤šäººä¸­</h4>
          <p>äº”ç©€ç²‰é›–å¥åº·ï¼Œä½†ç£¨ç²‰å¾Œæ˜“è½‰ç‚ºã€Œç³–æ°´ã€ï¼Œæå°è‡´è‚¥èƒ–èˆ‡è¡€ç³–é£†å‡ã€‚å»ºè­°é¸åŸå‹ç©€ç‰©ã€æ§åˆ¶ä»½é‡ï¼Œæ­é…è›‹ç™½è³ªèˆ‡å¥½æ²¹è„‚ï¼Œé¿å…å¤©å¤©å¤§é‡é£²ç”¨ã€‚</p>
          <a href="https://health.udn.com/health/story/6037/8227694" class="news-btn" target="_blank"
            rel="noopener noreferrer">é–±è®€å…¨æ–‡</a>
        </div>
        <div class="news-item">
          <h4>æ¸›è‚¥å¤±æ•—çœŸç›¸æ›å…‰ï¼è›‹ç™½è³ªåƒä¸å¤ æ‰æ˜¯ä¸»å› </h4>
          <p>ç ”ç©¶æŒ‡å‡ºï¼Œè›‹ç™½è³ªæ”å–ä¸è¶³æœƒå°è‡´éåº¦é€²é£Ÿã€ç†±é‡è¶…æ¨™ï¼Œåè€Œè®Šèƒ–ã€‚æ¸›é‡æ™‚æ‡‰ç¢ºä¿é£²é£Ÿä¸­è›‹ç™½è³ªé”15%ï¼Œæå‡é£½è¶³æ„Ÿã€ç©©å®šé£Ÿæ…¾ï¼Œæ‰èƒ½æœ‰æ•ˆæ§åˆ¶é«”é‡ï¼Œé¿å…é«˜è„‚èˆ‡é«˜ç³–é£²é£Ÿã€‚</p>
          <a href="https://tw.news.yahoo.com/%E6%B8%9B%E8%82%A5%E5%A4%B1%E6%95%97%E7%9C%9F%E7%9B%B8%E6%9B%9D%E5%85%89-%E8%9B%8B%E7%99%BD%E8%B3%AA%E5%90%83%E4%B8%8D%E5%A4%A0%E6%89%8D%E6%98%AF%E4%B8%BB%E5%9B%A0-002333952.html"
            class="news-btn" target="_blank" rel="noopener noreferrer">é–±è®€å…¨æ–‡</a>
        </div>
      </div>
      <p class="update-date"><span>è³‡æ–™æ›´æ–°æ—¥æœŸï¼š</span><span id="updateDate">2025-09-26</span></p>
    </div>
  </section>
  <footer>
    <p>&copy; 2025 å¥åº·ç®¡å®¶ Health Tracker</p>
  </footer>

  <script>
    
    document.addEventListener('DOMContentLoaded', async () => {
      const idToken = sessionStorage.getItem('firebaseIdToken');
      const userIdentity = document.getElementById("user-identity");
      const authLinks = document.getElementById("auth-links");
      const loginLinks = document.getElementById("login-links");
      const welcomeTitle = document.getElementById("welcome-title");
      const userInfoBox = document.getElementById("userInfo");


      if (!idToken) {
        authLinks.style.display = "none";
        loginLinks.style.display = "inline";
        // ä¸è‡ªå‹•è·³è½‰ï¼Œè®“æœªç™»å…¥ä½¿ç”¨è€…ä¹Ÿèƒ½çœ‹åˆ°æ–°è
        welcomeTitle.textContent = "æ­¡è¿è¨ªå®¢ï¼ç™»å…¥å¾Œå¯æŸ¥çœ‹å€‹äººåŒ–è³‡è¨Š";
        userInfoBox.innerHTML = '<p>è«‹<a href="/login">ç™»å…¥</a>ä»¥æŸ¥çœ‹æ‚¨çš„å€‹äººè³‡æ–™ã€‚</p>';
        userInfoBox.style.display = "block";
        return;
      }

      try {
        // ä½¿ç”¨ GET æ–¹æ³•ä¸¦å°‡ token æ”¾åœ¨ Authorization header
        const response = await fetch('/api/user-profile', {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${idToken}`
          }
        });

        if (!response.ok) {
          const errData = await response.json();
          throw new Error(errData.error || 'ç„¡æ³•ç²å–ä½¿ç”¨è€…è³‡æ–™ï¼Œè«‹é‡æ–°ç™»å…¥');
        }

        const data = await response.json();

        // æ›´æ–° UI é¡¯ç¤ºç™»å…¥ç‹€æ…‹
        authLinks.style.display = "inline";
        loginLinks.style.display = "none";

        const username = data.username || data.email;
        welcomeTitle.textContent = `ğŸ‘‹ æ­¡è¿å›ä¾†ï¼Œ${username}`;
        userIdentity.textContent = username;

        // å¡«å……å€‹äººè³‡æ–™
        userInfoBox.style.display = "block";
        document.getElementById("username").textContent = data.username || "æœªå¡«å¯«";
        document.getElementById("fullname").textContent = data.fullname || "æœªå¡«å¯«";
        document.getElementById("gender").textContent = data.gender || "æœªå¡«å¯«";
        document.getElementById("birthdate").textContent = data.birthdate || "æœªå¡«å¯«";
        document.getElementById("diet").textContent = data.diet || "æœªå¡«å¯«";
        document.getElementById("goal").textContent = data.goal || "æœªå¡«å¯«";
        document.getElementById("allergens").textContent = (data.allergens || []).join(", ") || "ç„¡";

      } catch (error) {
        console.error('API å‘¼å«å¤±æ•—:', error);
        // Token å¯èƒ½ç„¡æ•ˆæˆ–éæœŸï¼Œæ¸…é™¤å®ƒä¸¦æç¤ºé‡æ–°ç™»å…¥
        sessionStorage.removeItem('firebaseIdToken');
        authLinks.style.display = "none";
        loginLinks.style.display = "inline";
        userInfoBox.innerHTML = `<p>âš ï¸ é©—è­‰å·²éæœŸï¼Œè«‹<a href="/login">é‡æ–°ç™»å…¥</a>ä»¥æŸ¥çœ‹æ‚¨çš„å€‹äººè³‡æ–™ã€‚</p>`;
        userInfoBox.style.display = "block";
      }
    });

    // ç™»å‡ºæŒ‰éˆ•çš„äº‹ä»¶ç›£è½
    const logoutBtn = document.getElementById("logoutBtn");
    logoutBtn?.addEventListener("click", () => {
      sessionStorage.removeItem('firebaseIdToken');
      window.location.href = "/login";
    });
  </script>
</body>

</html>